# 04. 감사 및 신뢰성 (Auditing and Reliability)

금융 시스템은 단순히 거래를 처리하는 것을 넘어, 모든 기록을 추적할 수 있고(감사), 예외적인 상황에서도 데이터가 손실되지 않도록(신뢰성) 보장해야 합니다.

## 1. 감사 추적 (Audit Trail)

모든 거래는 명확한 감사 추적 기록을 남겨야 합니다. "언제, 누가, 무엇을, 어떻게 했는가"를 알 수 있어야 합니다.

- **기술 구현:** `TransferAuditEvent.kt`
    - 이 객체는 `Transfer` 거래의 상태가 변경될 때마다 생성되어 기록됩니다.
    - 예를 들어, 거래가 `PENDING` -> `COMPLETED` 로 변경되는 시점, 혹은 `PENDING` -> `FAILED` 로 변경되는 시점의 타임스탬프와 변경 사유(`reason`) 등이 모두 기록됩니다.
    - 이를 통해 특정 거래에 무슨 일이 있었는지 시간 순서대로 정확하게 재구성할 수 있습니다. 이는 문제 해결, 고객 문의 응대, 그리고 규제 준수에 필수적입니다.

## 2. 오류 처리 및 신뢰성 (Error Handling & Reliability)

거래 처리 중 예상치 못한 시스템 장애(네트워크 문제, DB 다운 등)가 발생하더라도, 거래 정보가 유실되어서는 안 됩니다.

- **기술 구현:** `DeadLetterEntry.kt`
    - 만약 트랜잭션을 처리하던 중 알 수 없는 이유로 실패하여 롤백되었지만, 그 원인을 즉시 파악하기 어려운 경우, 해당 거래 정보를 **Dead Letter Queue(DLQ)** 개념을 차용한 `dead_letter_entries` 테이블에 기록합니다.
    - 이것은 "죽었지만 버리지 않은 편지"처럼, 문제가 있는 거래를 안전한 곳에 따로 보관하는 것입니다.
    - 개발자나 운영자는 주기적으로 이 테이블을 확인하여, 실패 원인을 분석하고 필요한 경우 수동으로 복구 절차(예: 재처리 또는 강제 취소)를 진행할 수 있습니다.
    - 이 메커니즘은 **어떤 거래도 시스템에서 소리 없이 사라지지 않도록** 보장하는 최후의 안전망입니다. `TransferFailureDurabilityTest.kt` 테스트 코드는 바로 이러한 시나리오를 검증합니다.
